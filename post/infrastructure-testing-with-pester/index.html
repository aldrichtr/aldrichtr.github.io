<!doctype html><html lang=en-us class=dark><head><title>Tim Aldrich | Infrastructure Testing With Pester</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,minimum-scale=1"><link rel=apple-touch-icon sizes=180x180 href=/favicon/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon/favicon-16x16.png><link rel=manifest href=/favicon/site.webmanifest><link rel=mask-icon href=/favicon/safari-pinned-tab.svg color=#5bbad5><link rel="shortcut icon" href=/favicon/favicon.ico><meta name=theme-color content="#ffffff"><meta property="og:title" content="Tim Aldrich | Infrastructure Testing With Pester"><link rel=stylesheet href="/css/style.min.8e7bcdffab6bbed366372e694f634ed1ccdeae445b32dfeaf0395832323641f0.css"><link href=/css/blonde.min.css rel=stylesheet type=text/css media=print onload='this.media=" all"'><meta name=description content="Infrastructure testing This is part 1 in a series on &ldquo;Infrastructure testing modules&rdquo;
What is &ldquo;Infrastructure Testing&rdquo; In my own words, infrastructure testing is:
validating that a configuration item is the value that you expect it to be.
For example:
 Is the Operating System Windows Server? Is the DNS service running? Is the count of members of the local &lsquo;Administrators&rsquo; group 3?  As a sysadmin, these are things that I would check on as part of my daily operations tasks, and also things that I would check on during troubleshooting."><meta property="og:site_name" content="Tim Aldrich"><meta property="og:description" content="Infrastructure testing This is part 1 in a series on &ldquo;Infrastructure testing modules&rdquo;
What is &ldquo;Infrastructure Testing&rdquo; In my own words, infrastructure testing is:
validating that a configuration item is the value that you expect it to be.
For example:
 Is the Operating System Windows Server? Is the DNS service running? Is the count of members of the local &lsquo;Administrators&rsquo; group 3?  As a sysadmin, these are things that I would check on as part of my daily operations tasks, and also things that I would check on during troubleshooting."><meta property="og:url" content="https://aldrichtr.github.io/post/infrastructure-testing-with-pester/"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content><link rel=canonical href=https://aldrichtr.github.io/post/infrastructure-testing-with-pester/><meta name=twitter:description content="Infrastructure testing This is part 1 in a series on &ldquo;Infrastructure testing modules&rdquo;
What is &ldquo;Infrastructure Testing&rdquo; In my own words, infrastructure testing is:
validating that a configuration item is the value that you expect it to be.
For example:
 Is the Operating System Windows Server? Is the DNS service running? Is the count of members of the local &lsquo;Administrators&rsquo; group 3?  As a sysadmin, these are things that I would check on as part of my daily operations tasks, and also things that I would check on during troubleshooting."><meta property="article:published_time" content="2022-04-18T11:06:08-04:00"><meta property="article:updated_time" content="2022-04-18T19:21:49-04:00"><meta property="og:image" content="https://aldrichtr.github.io/img/post/pester_v5.png"><meta property="og:image:url" content="https://aldrichtr.github.io/img/post/pester_v5.png"><link rel=stylesheet href=/css/custom.css><i class="dark hidden"></i></head><body class=font-sans><div class="min-h-screen flex flex-col bg-gray-100 dark:bg-warmgray-800"><div><div class="container max-w-screen-xl mr-auto ml-auto"><nav class="flex items-center justify-between flex-wrap p-6"><div class="flex items-center flex-no-shrink text-white mr-6"><a href=https://aldrichtr.github.io/><span class="font-semibold text-2xl tracking-tight">Tim Aldrich</span></a></div><div class="flex md:hidden"><div class=py-2><button onclick=toggleDarkMode() class="focus:outline-none mr-1" aria-label="Darkmode Toggle Button"><i id=icon class="icon-moon inline-flex align-middle leading-normal text-lg text-white"></i></button>
<span class=text-white>|</span></div><button id=hamburgerbtn class="flex items-center px-3 py-1 text-white hover:opacity-50" aria-label="Hamburger Button">
<span class="icon-menu text-2xl"></span></button></div><div class="hidden w-full md:flex md:flex-row sm:items-center md:w-auto" id=mobileMenu><div class="text-sm lg:flex-grow"></div><div class=navmenu><a href=/post/ class="no-underline duration-200 block mt-4 sm:inline-block sm:mt-0 text-white hover:opacity-50 mr-4">Blog</a>
<a href=/projects/ class="no-underline duration-200 block mt-4 sm:inline-block sm:mt-0 text-white hover:opacity-50 mr-4">Projects</a>
<a href=/about/ class="no-underline duration-200 block mt-4 sm:inline-block sm:mt-0 text-white hover:opacity-50 mr-4">About</a></div><div class="text-white invisible md:visible"><span>|</span>
<button onclick=toggleDarkMode() class=focus:outline-none aria-label="Darkmode Toggle Button"><i id=icon2 class="icon-moon hover:opacity-50 duration-200 inline-flex align-middle leading-normal text-lg ml-2"></i></button></div></div></nav></div></div><style>.active{display:block}</style><script>let hamburger=document.getElementById("hamburgerbtn"),mobileMenu=document.getElementById("mobileMenu");hamburger.addEventListener("click",function(){mobileMenu.classList.toggle("active")})</script><div class="container max-w-screen-xl mx-auto mt-4 flex-grow px-5 lg:px-0" id=content><div class=lg:mx-5><div class="grid grid-cols-3 gap-4"><div class="col-span-3 lg:col-span-2 dark:text-white"><div class="bg-white dark:bg-warmgray-900 p-5 my-4"><h1 class="title text-4xl">Infrastructure Testing With Pester</h1><hr class=my-2><aside id=meta><div><section><h4 id=date><span class="icon-access_time mr-2"></span>2022/04/18</h4></section><div id=tags><span class="icon-local_offer mr-1"></span>
<a href=https://aldrichtr.github.io/tags/powershell>powershell</a> |
<a href=https://aldrichtr.github.io/tags/pester>pester</a> |</div></div></aside><hr class=my-2><img class=py-4 src=https://aldrichtr.github.io/img/post/pester_v5.png><div class="content mt-5"><h2 id=infrastructure-testing>Infrastructure testing</h2><p>This is part 1 in a series on &ldquo;Infrastructure testing modules&rdquo;</p><h2 id=what-is-infrastructure-testing>What is &ldquo;Infrastructure Testing&rdquo;</h2><p>In my own words, infrastructure testing is:</p><p><em>validating that a configuration item is the value that you expect it to be.</em></p><p>For example:</p><ul><li>Is the Operating System Windows Server?</li><li>Is the DNS service running?</li><li>Is the count of members of the local &lsquo;Administrators&rsquo; group 3?</li></ul><p>As a sysadmin, these are things that I would check on as part of my daily operations tasks, and also things that I
would check on during troubleshooting. But as infrastructure gets larger, spanning across multiple environments,
multiple layers of virtualization and multiple vendors, versions and applications it becomes too complex and time
consuming to do without automation.</p><h2 id=pester-testing-module>Pester testing module</h2><p>Most programming languages have a testing library that allows the developer to write tests that validate that their
code does what is expected. PowerShell is no different, and the de-facto module for those tests is
<a href=https://pester.dev>Pester</a></p><p>Pester follows the <a href=https://en.wikipedia.org/wiki/Behavior-driven_development#Story_versus_specification>Behavior Driven
Design</a> &ldquo;specification&rdquo;
language; mainly the use of <code>Describe</code>, <code>Context</code>, <code>It</code>, and <code>Should</code>. These four &ldquo;Domain Specific Language (DSL)&rdquo;
keywords allow you to write a test that sounds a lot like natural language.</p><p>here is an example strait from the Pester documentation:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>BeforeAll {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>function</span> Get-Planet (<span style=color:#66d9ef>[string]</span>$Name = <span style=color:#e6db74>&#39;*&#39;</span>) {
</span></span><span style=display:flex><span>        $planets = @(
</span></span><span style=display:flex><span>            @{ Name = <span style=color:#e6db74>&#39;Mercury&#39;</span> }
</span></span><span style=display:flex><span>            @{ Name = <span style=color:#e6db74>&#39;Venus&#39;</span>   }
</span></span><span style=display:flex><span>            @{ Name = <span style=color:#e6db74>&#39;Earth&#39;</span>   }
</span></span><span style=display:flex><span>            @{ Name = <span style=color:#e6db74>&#39;Mars&#39;</span>    }
</span></span><span style=display:flex><span>            @{ Name = <span style=color:#e6db74>&#39;Jupiter&#39;</span> }
</span></span><span style=display:flex><span>            @{ Name = <span style=color:#e6db74>&#39;Saturn&#39;</span>  }
</span></span><span style=display:flex><span>            @{ Name = <span style=color:#e6db74>&#39;Uranus&#39;</span>  }
</span></span><span style=display:flex><span>            @{ Name = <span style=color:#e6db74>&#39;Neptune&#39;</span> }
</span></span><span style=display:flex><span>        ) | ForEach-Object { <span style=color:#66d9ef>[PSCustomObject]</span> $_ }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        $planets | Where-Object { $_.Name <span style=color:#f92672>-like</span> $Name }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Describe <span style=color:#e6db74>&#39;Get-Planet&#39;</span> {
</span></span><span style=display:flex><span>    It <span style=color:#e6db74>&#39;Given no parameters, it lists all 8 planets&#39;</span> {
</span></span><span style=display:flex><span>        $allPlanets = Get-Planet
</span></span><span style=display:flex><span>        $allPlanets.Count | Should -Be 8
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=operations-validation-framework>Operations Validation Framework</h2><p>One of the first modules that used Pester to test infrastructure was <a href=https://github.com/PowerShell/Operation-Validation-Framework>Operation Validation
Framework</a>. Although the project was abandoned about
3 years ago, it is still available to download from github and the powershell gallery.</p><p><strong>WARNING</strong> OVF was based on an older version of Pester, and Pester has made some <a href=https://pester.dev/docs/migrations/breaking-changes-in-v5>breaking
changes</a> in version 5. It probably wont work if you try
to use it on a modern system.</p><p>That said, the design of OVF was strait-forward: Create a module structure with your tests organized into two
folders: <code>Diagnostics\Simple</code> and <code>Diagnostics\Comprehensive</code>. These files use the Pester default file naming
convention, <code>*.Tests.ps1</code>.</p><p>With your tests organized in this way, calling <code>Invoke-OperationValidation</code> will run the Pester tests in the folders
and produce a report of the test name and result.</p><p>See the example in the README.md</p><h2 id=poshspec>Poshspec</h2><p><a href=https://github.com/ticketmaster/poshspec>poshspec</a> added some very useful terms to the DSL, such as <code>File</code>,
<code>Hotfix</code>, etc. There is a list of them on the <a href=https://github.com/Ticketmaster/poshspec/wiki/Introduction>wiki</a>.
This made the tests even more like natural language.</p><p>Unfortunately, this site also stopped being updated around the same time as OVF, and has the same issues when
running with Pester v5</p><h2 id=psremotely>PSRemotely</h2><p>Lastly, <a href=https://github.com/DexterPOSH/PSRemotely>psremotely</a> was another PowerShell infrastructure testing module
based on Pester. It also had its own DSL terms such as <code>Nodes</code> to describe the &ldquo;target&rdquo; computers to run the tests
on.</p><p>Where OVF ran the tests locally, PSRemotely ran them, well &mldr;. remotely. The idea was to copy the tests and all
the modules, scripts and resources required to run them to the remote system, run the tests and then retrieve the
results and write them to the local machine as a json object.</p></div><aside id=meta><hr class=py-2><div id=categories><span class="icon-folder text-xl mr-1"></span>
<span class="inline-flex py-2 leading-4 mr-2 mb-2 content-center bg-gray-200 justify-center h-8 px-3 text-blue-500 duration-200 hover:text-black dark:bg-warmgray-800"><a href=https://aldrichtr.github.io/categories/development>Development</a></span></div></aside></div><div class="bg-white dark:bg-warmgray-900 p-5 my-4"><div class="grid grid-cols-2"><div class=col-span-1><a class="previous lg:text-2xl" href=https://aldrichtr.github.io/post/my-first-post/><div class="transition-colors duration-300 border border-gray-600 hover:border-black h-auto m-3 text-center py-3 lg:py-1"><span class=icon-keyboard_arrow_left></span> "Hello World" | Set-Content blog</div></a></div></div></div><div class="bg-white dark:bg-warmgray-900 p-5 my-4"><div class=mb-3></div></div></div><div class="hidden lg:block lg:col-span-1"><div class=mb-3><form class=widget-search__form role=search method=get action=https://google.com/search><label><input class="w-full p-3 focus:outline-none dark:bg-warmgray-900 dark:text-white placeholder-gray-700 dark:placeholder-gray-300" type=search placeholder=Search... name=q aria-label=Search></label>
<input class=hidden type=submit value=Search>
<input type=hidden name=sitesearch value=https://aldrichtr.github.io/></form></div><div class="bg-white panel mb-3 pb-5 dark:bg-warmgray-900"><p class="text-xl text-center text-gray-700 py-3 px-3 dark:text-gray-300">Archives</p><div class=mx-4><select class="text-center block mx-auto w-full py-2 px-4 duration-100 bg-white hover:bg-gray-200 text-gray-800 dark:bg-warmgray-900 dark:text-gray-200 dark:hover:bg-warmgray-800" name=archive onchange="location.href=value"><option>Select Archive...</option><option value=https://aldrichtr.github.io//archives/2022/02>2022/02 (1)</option></select></div></div><div class="bg-white panel mb-3 pb-5 dark:bg-warmgray-900"><p class="text-xl text-center text-gray-700 py-5 dark:text-gray-300">Categories</p><a class="text-center block duration-100 py-2 px-4 mx-4 hover:bg-gray-100 text-gray-800 dark:text-gray-200 dark:hover:bg-warmgray-800" href=https://aldrichtr.github.io//categories/development>Development</a></div><div class="bg-white panel mb-3 dark:bg-warmgray-900"><p class="text-xl text-center text-gray-700 py-3 pl-3 dark:text-gray-300">Tags</p><div class="panel-block p-2"><a href=/tags/hello><span class="duration-100 inline-flex py-2 leading-4 mr-2 mb-2 content-center bg-gray-100 justify-center h-8 px-3 text-blue-500 hover:text-blue-900 dark:bg-warmgray-800">hello</span></a>
<a href=/tags/hugo><span class="duration-100 inline-flex py-2 leading-4 mr-2 mb-2 content-center bg-gray-100 justify-center h-8 px-3 text-blue-500 hover:text-blue-900 dark:bg-warmgray-800">hugo</span></a>
<a href=/tags/pester><span class="duration-100 inline-flex py-2 leading-4 mr-2 mb-2 content-center bg-gray-100 justify-center h-8 px-3 text-blue-500 hover:text-blue-900 dark:bg-warmgray-800">pester</span></a>
<a href=/tags/powershell><span class="duration-100 inline-flex py-2 leading-4 mr-2 mb-2 content-center bg-gray-100 justify-center h-8 px-3 text-blue-500 hover:text-blue-900 dark:bg-warmgray-800">powershell</span></a></div></div><div class="bg-white panel mb-3 pb-5 dark:bg-warmgray-900"><p class="text-xl text-center text-gray-700 py-5 dark:text-gray-300">Recent Posts</p><div class=mx-6><a href=/post/my-first-post/><div class="w-full block mt-3 bg-white hover:bg-gray-100 duration-200 dark:bg-warmgray-900 dark:text-gray-200 dark:hover:bg-warmgray-800"><div class=px-2><div class="text-gray-900 font-bold text-xl dark:text-white">"Hello World" | Set-Content blog</div><p class="text-sm text-gray-600 flex items-center pb-1 dark:text-gray-400"><time><span class="icon-access_time mr-1"></span>2022/02/22</time></p></div></div><a href=/post/infrastructure-testing-with-pester/><div class="w-full block mt-3 bg-white hover:bg-gray-100 duration-200 dark:bg-warmgray-900 dark:text-gray-200 dark:hover:bg-warmgray-800"><div class=px-2><div class="text-gray-900 font-bold text-xl dark:text-white">Infrastructure Testing With Pester</div><p class="text-sm text-gray-600 flex items-center pb-1 dark:text-gray-400"><time><span class="icon-access_time mr-1"></span>2022/04/18</time></p></div></div></a></div></div></div></div></div></div><footer class="text-white p-6"><div class="container max-w-screen-xl mr-auto ml-auto"><p>&copy; 2022 <a href=https://aldrichtr.github.io/ class="duration-200 hover:opacity-50">Tim Aldrich</a></p><p>Powered by <a href=https://gohugo.io/ class="duration-200 hover:opacity-50">Hugo</a>, Theme <a href=https://github.com/opera7133/Blonde class="duration-200 hover:opacity-50">Blonde</a>.</p></div><script>var icon=document.getElementById("icon"),icon2=document.getElementById("icon2");document.documentElement.classList.contains("dark")||localStorage.theme==="dark"||!("theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches?(icon.classList.remove("icon-moon"),icon.classList.add("icon-sun"),icon2.classList.remove("icon-moon"),icon2.classList.add("icon-sun"),document.documentElement.classList.add("dark")):document.documentElement.classList.remove("dark");function toggleDarkMode(){document.documentElement.classList.contains("dark")?(icon.classList.remove("icon-sun"),icon.classList.add("icon-moon"),icon2.classList.remove("icon-sun"),icon2.classList.add("icon-moon"),document.documentElement.classList.remove("dark"),localStorage.theme="light"):(icon.classList.remove("icon-moon"),icon.classList.add("icon-sun"),icon2.classList.remove("icon-moon"),icon2.classList.add("icon-sun"),document.documentElement.classList.add("dark"),localStorage.theme="dark")}</script></footer></div></body></html>