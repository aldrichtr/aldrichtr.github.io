<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Infrastructure Testing With Pester - Tim Aldrich</title><meta name=Description content="A walkthrough of using Pester to test your infrastructure"><meta property="og:title" content="Infrastructure Testing With Pester"><meta property="og:description" content="A walkthrough of using Pester to test your infrastructure"><meta property="og:type" content="article"><meta property="og:url" content="https://aldrichtr.github.io/posts/infrastructure-testing-with-pester/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-04-18T16:58:16-05:00"><meta property="article:modified_time" content="2023-03-10T19:18:26-05:00"><meta property="og:site_name" content="My cool site"><meta property="og:see_also" content="https://aldrichtr.github.io/posts/auditing-standards-and-frameworks/"><meta name=twitter:card content="summary"><meta name=twitter:title content="Infrastructure Testing With Pester"><meta name=twitter:description content="A walkthrough of using Pester to test your infrastructure"><meta name=application-name content="Get-RandomIdea | Set-Content &#34;~/blog&#34;"><meta name=apple-mobile-web-app-title content="Get-RandomIdea | Set-Content &#34;~/blog&#34;"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://aldrichtr.github.io/posts/infrastructure-testing-with-pester/><link rel=prev href=https://aldrichtr.github.io/posts/my-first-post/><link rel=next href=https://aldrichtr.github.io/posts/auditing-standards-and-frameworks/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Infrastructure Testing With Pester","inLanguage":"en-us","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/aldrichtr.github.io\/posts\/infrastructure-testing-with-pester\/"},"genre":"posts","keywords":"powershell, pester","wordcount":583,"url":"https:\/\/aldrichtr.github.io\/posts\/infrastructure-testing-with-pester\/","datePublished":"2022-04-18T16:58:16-05:00","dateModified":"2023-03-10T19:18:26-05:00","license":"2022 Timothy Aldrich","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"Tim Aldrich"},"description":"A walkthrough of using Pester to test your infrastructure"}</script></head><body data-header-desktop=auto data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"dark"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"dark"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Tim Aldrich">Get-RandomIdea | Set-Content "~/blog"</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/ title=Posts>Blog </a><a class=menu-item href=/tags/ title=Tags>Tags </a><a class=menu-item href=/categories/ title=Categories>Categories </a><a class=menu-item href=/about/ title=AboutPages>About </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder="Search titles or contents..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Tim Aldrich">Get-RandomIdea | Set-Content "~/blog"</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Search titles or contents..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></div><a class=menu-item href=/posts/ title=Posts>Blog</a><a class=menu-item href=/tags/ title=Tags>Tags</a><a class=menu-item href=/categories/ title=Categories>Categories</a><a class=menu-item href=/about/ title=AboutPages>About</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Infrastructure Testing With Pester</h1><h2 class=single-subtitle>Using Behavior Driven Design testing to validate your infrastructure</h2><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>Tim Aldrich</a></span>&nbsp;<span class=post-category>included in <a href=/categories/iac/><i class="far fa-folder fa-fw" aria-hidden=true></i>IaC</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime="2022 Apr 18">2022 Apr 18</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;583 words&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;3 minutes&nbsp;</div></div><div class=featured-image><img class=lazyload src=/svg/loading.min.svg data-src=/posts/infrastructure-testing-with-pester/pester_v5.png data-srcset="/posts/infrastructure-testing-with-pester/pester_v5.png, /posts/infrastructure-testing-with-pester/pester_v5.png 1.5x, /posts/infrastructure-testing-with-pester/pester_v5.png 2x" data-sizes=auto alt=/posts/infrastructure-testing-with-pester/pester_v5.png title="A walkthrough of using Pester to test your infrastructure" width=1147 height=700></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ol><li><a href=#what-is-infrastructure-testing>What is &ldquo;Infrastructure Testing&rdquo;</a></li><li><a href=#pester-testing-module>Pester testing module</a></li><li><a href=#operations-validation-framework>Operations Validation Framework</a></li><li><a href=#poshspec>Poshspec</a></li><li><a href=#psremotely>PSRemotely</a></li></ol></nav></div></div><br><div class="details toc"><div class="details-summary toc-title"><span>This article is part of a series.</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true>&nbsp;</i></span></div><div class="details-content toc-content"><ul><li>Part 1: This Article</li><li><a href=https://aldrichtr.github.io/posts/auditing-standards-and-frameworks/>Part 2:
Auditing Standards and Frameworks</a></li></ul></div></div><hr><div class=content id=content><p>Use PowerShell&rsquo;s de facto standard unit testing module to validate your infrastructure is deployed and configured to
your specifications.</p><h2 id=what-is-infrastructure-testing>What is &ldquo;Infrastructure Testing&rdquo;</h2><p>In my own words, infrastructure testing is:</p><p><em>validating that a configuration item is the value that you expect it to be.</em></p><p>For example:</p><ul><li>Is the Operating System Windows Server?</li><li>Is the DNS service running?</li><li>Is the count of members of the local &lsquo;Administrators&rsquo; group 3?</li></ul><p>As a sysadmin, these are things that I would check on as part of my daily operations tasks, and also things that I
would check on during troubleshooting. But as infrastructure gets larger; spanning across multiple environments,
multiple layers of virtualization and multiple vendors, versions and applications it becomes too complex and time
consuming to do without automation.</p><h2 id=pester-testing-module>Pester testing module</h2><p>Most programming languages have a testing library that allows the developer to write tests that validate that their
code does what is expected. PowerShell is no different, and the de-facto module for those tests is
<a href=https://pester.dev target=_blank rel="noopener noreffer">Pester</a></p><p>Pester follows the <a href=https://en.wikipedia.org/wiki/Behavior-driven_development#Story_versus_specification target=_blank rel="noopener noreffer">Behavior Driven
Design</a> &ldquo;specification&rdquo;
language; mainly the use of <code>Describe</code>, <code>Context</code>, <code>It</code>, and <code>Should</code>. These four &ldquo;Domain Specific Language (DSL)&rdquo;
keywords allow you to write a test that sounds a lot like natural language.</p><p>here is an example straight from the Pester documentation:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>BeforeAll</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>function</span><span class=w> </span><span class=nb>Get-Planet</span> <span class=p>([</span><span class=no>string</span><span class=p>]</span><span class=nv>$Name</span> <span class=p>=</span> <span class=s1>&#39;*&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$planets</span> <span class=p>=</span> <span class=vm>@</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=vm>@</span><span class=p>{</span> <span class=n>Name</span> <span class=p>=</span> <span class=s1>&#39;Mercury&#39;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=vm>@</span><span class=p>{</span> <span class=n>Name</span> <span class=p>=</span> <span class=s1>&#39;Venus&#39;</span>   <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=vm>@</span><span class=p>{</span> <span class=n>Name</span> <span class=p>=</span> <span class=s1>&#39;Earth&#39;</span>   <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=vm>@</span><span class=p>{</span> <span class=n>Name</span> <span class=p>=</span> <span class=s1>&#39;Mars&#39;</span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=vm>@</span><span class=p>{</span> <span class=n>Name</span> <span class=p>=</span> <span class=s1>&#39;Jupiter&#39;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=vm>@</span><span class=p>{</span> <span class=n>Name</span> <span class=p>=</span> <span class=s1>&#39;Saturn&#39;</span>  <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=vm>@</span><span class=p>{</span> <span class=n>Name</span> <span class=p>=</span> <span class=s1>&#39;Uranus&#39;</span>  <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=vm>@</span><span class=p>{</span> <span class=n>Name</span> <span class=p>=</span> <span class=s1>&#39;Neptune&#39;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span> <span class=p>|</span> <span class=nb>ForEach-Object</span> <span class=p>{</span> <span class=p>[</span><span class=no>PSCustomObject</span><span class=p>]</span> <span class=nv>$_</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nv>$planets</span> <span class=p>|</span> <span class=nb>Where-Object</span> <span class=p>{</span> <span class=nv>$_</span><span class=p>.</span><span class=py>Name</span> <span class=o>-like</span> <span class=nv>$Name</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Describe</span> <span class=s1>&#39;Get-Planet&#39;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>It</span> <span class=s1>&#39;Given no parameters, it lists all 8 planets&#39;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$allPlanets</span> <span class=p>=</span> <span class=nb>Get-Planet</span>
</span></span><span class=line><span class=cl>        <span class=nv>$allPlanets</span><span class=p>.</span><span class=py>Count</span> <span class=p>|</span> <span class=n>Should</span> <span class=n>-Be</span> <span class=mf>8</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=operations-validation-framework>Operations Validation Framework</h2><p>One of the first modules that used Pester to test infrastructure was <a href=https://github.com/PowerShell/Operation-Validation-Framework target=_blank rel="noopener noreffer">Operation Validation
Framework</a>. Although the project was abandoned about
3 years ago, it is still available to download from github and the powershell gallery.</p><p><div class="details admonition warning open"><div class="details-summary admonition-title"><i class="icon fas fa-exclamation-triangle fa-fw" aria-hidden=true></i>Breaking Changes<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content><strong>WARNING</strong> OVF was based on an older version of Pester, and Pester has made some <a href=https://pester.dev/docs/migrations/breaking-changes-in-v5 target=_blank rel="noopener noreffer">breaking
changes</a> in version 5. It probably wont work if you try
to use it on a modern system.</div></div></div>That said, the design of OVF was strait-forward: Create a module structure with your tests organized into two
folders: <code>Diagnostics\Simple</code> and <code>Diagnostics\Comprehensive</code>. These files use the Pester default file naming
convention, <code>*.Tests.ps1</code>.</p><p>With your tests organized in this way, calling <code>Invoke-OperationValidation</code> will run the Pester tests in the folders
and produce a report of the test name and result.</p><p>See the example in the README.md</p><h2 id=poshspec>Poshspec</h2><p><a href=https://github.com/ticketmaster/poshspec target=_blank rel="noopener noreffer">poshspec</a> added some very useful terms to the DSL, such as <code>File</code>,
<code>Hotfix</code>, etc. There is a list of them on the <a href=https://github.com/Ticketmaster/poshspec/wiki/Introduction target=_blank rel="noopener noreffer">wiki</a>.
This made the tests even more like natural language.</p><p>Unfortunately, this site also stopped being updated around the same time as OVF, and has the same issues when
running with Pester v5</p><h2 id=psremotely>PSRemotely</h2><p>Lastly, <a href=https://github.com/DexterPOSH/PSRemotely target=_blank rel="noopener noreffer">psremotely</a> was another PowerShell infrastructure testing module
based on Pester. It also had its own DSL terms such as <code>Nodes</code> to describe the &ldquo;target&rdquo; computers to run the tests
on.</p><p>Where OVF ran the tests locally, PSRemotely ran them, well &mldr;. remotely. The idea was to copy the tests and all
the modules, scripts and resources required to run them to the remote system, run the tests and then retrieve the
results and write them to the local machine as a json object.</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2023 Mar 10</span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on Twitter" data-sharer=twitter data-url=https://aldrichtr.github.io/posts/infrastructure-testing-with-pester/ data-title="Infrastructure Testing With Pester" data-hashtags=powershell,pester><i class="fab fa-twitter fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Facebook" data-sharer=facebook data-url=https://aldrichtr.github.io/posts/infrastructure-testing-with-pester/ data-hashtag=powershell><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Linkedin" data-sharer=linkedin data-url=https://aldrichtr.github.io/posts/infrastructure-testing-with-pester/><i class="fab fa-linkedin fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Hacker News" data-sharer=hackernews data-url=https://aldrichtr.github.io/posts/infrastructure-testing-with-pester/ data-title="Infrastructure Testing With Pester"><i class="fab fa-hacker-news fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Line" data-sharer=line data-url=https://aldrichtr.github.io/posts/infrastructure-testing-with-pester/ data-title="Infrastructure Testing With Pester"><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@7.3.0/icons/line.svg aria-hidden=true></i></a><a href=javascript:void(0); title="Share on 微博" data-sharer=weibo data-url=https://aldrichtr.github.io/posts/infrastructure-testing-with-pester/ data-title="Infrastructure Testing With Pester" data-image=pester_v5.png><i class="fab fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/powershell/>powershell</a>,&nbsp;<a href=/tags/pester/>pester</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/posts/my-first-post/ class=prev rel=prev title='"Hello World" | Set-Content blog'><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>"Hello World" | Set-Content blog</a>
<a href=/posts/auditing-standards-and-frameworks/ class=next rel=next title="Auditing Standards and Frameworks">Auditing Standards and Frameworks<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.111.2">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2022 - 2023</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank>Tim Aldrich</a></span>&nbsp;|&nbsp;<span class=license>CC BY 4.0</span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><script type=text/javascript src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/twemoji@14.0.2/dist/twemoji.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:50},comment:{},search:{highlightTag:"em",lunrIndexURL:"/index.json",maxResultLength:10,noResultsFound:"No results found",snippetLength:30,type:"lunr"},twemoji:!0}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>